{% extends 'base/layout.html' %}
{% block title %}Dashboard | MEDICAPP {% endblock %}

{% block content %}
<div class="flex min-h-screen bg-gray-100">

    {% include 'admin/admin_sidebar.html' %}

    <!-- MAIN CONTENT -->
    <div class="flex-1 p-8">

        <!-- TOP BAR -->
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">
                <span class="text-blue-600">Admin</span> Dashboard
            </h1>

            <div class="flex items-center gap-3">
                <span class="text-sm font-medium text-gray-700">Admin User</span>
                <img src="{{ url_for('static', filename='img/profile.jpg') }}"
                     class="w-10 h-10 rounded-full shadow">
            </div>
        </div>

        <!-- STAT CARDS -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">

            <div class="bg-white rounded-2xl p-6 shadow hover:shadow-lg transition">
                <p class="text-sm text-gray-500">Total Patients</p>
                <p class="text-3xl font-bold text-gray-800 mt-2">1,248</p>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow hover:shadow-lg transition">
                <p class="text-sm text-gray-500">Total Doctors</p>
                <p class="text-3xl font-bold text-gray-800 mt-2">24</p>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow hover:shadow-lg transition">
                <p class="text-sm text-gray-500">Appointments</p>
                <p class="text-3xl font-bold text-gray-800 mt-2">432</p>
            </div>

            <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-2xl p-6 shadow-lg">
                <p class="text-sm opacity-90">Revenue</p>
                <p class="text-3xl font-bold mt-2">$45,231.89</p>
            </div>

        </div>

        <!-- CHART + ACTIVITY -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">

            <!-- CHART -->
            <div class="lg:col-span-2 bg-white rounded-2xl shadow p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                    Monthly Appointments
                </h3>
                <canvas id="monthlyAppointmentsChart" height="120"></canvas>
            </div>

            <!-- RECENT ACTIVITY -->
            <div class="bg-white rounded-2xl shadow p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                    Recent Activity
                </h3>

                <ul class="space-y-3 text-sm text-gray-700">
                    <li class="flex items-center gap-2">
                        <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                        New patient registered (10 mins ago)
                    </li>
                    <li class="flex items-center gap-2">
                        <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                        Appointment completed (25 mins ago)
                    </li>
                    <li class="flex items-center gap-2">
                        <span class="w-2 h-2 bg-yellow-500 rounded-full"></span>
                        New appointment scheduled
                    </li>
                    <li class="flex items-center gap-2">
                        <span class="w-2 h-2 bg-purple-500 rounded-full"></span>
                        Lab results uploaded
                    </li>
                </ul>
            </div>

        </div>

        <!-- STATISTICS SECTION -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- MONTHLY COUNTS -->
            <div class="bg-white rounded-2xl shadow p-6">
                <h4 class="font-semibold text-gray-800 mb-4">Monthly Breakdown</h4>
                {% if statistics.monthly_counts %}
                <ul class="space-y-2 text-sm">
                    {% for month, count in statistics.monthly_counts.items() %}
                    <li class="flex justify-between">
                        <span class="text-gray-600">{{ month }}</span>
                        <span class="font-medium">{{ count }}</span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-sm text-gray-500">No data available.</p>
                {% endif %}
            </div>

            <!-- STATUS COUNTS -->
            <div class="bg-white rounded-2xl shadow p-6">
                <h4 class="font-semibold text-gray-800 mb-4">Appointment Status</h4>
                {% if statistics.status_counts %}
                <ul class="space-y-2 text-sm">
                    {% for status, count in statistics.status_counts.items() %}
                    <li class="flex justify-between">
                        <span class="text-gray-600">{{ status }}</span>
                        <span class="font-medium">{{ count }}</span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-sm text-gray-500">No status data.</p>
                {% endif %}
            </div>

            <!-- BUSIEST DAY -->
            <div class="bg-white rounded-2xl shadow p-6">
                <h4 class="font-semibold text-gray-800 mb-4">Busiest Day</h4>
                {% if statistics.busiest_day_of_week %}
                <p class="text-3xl font-bold text-blue-600">
                    {{ statistics.busiest_day_of_week }}
                </p>
                {% else %}
                <p class="text-sm text-gray-500">
                    No data available.
                </p>
                {% endif %}
            </div>

        </div>

    </div>
</div>

<!-- Chart.js -->
<script>
const monthlyData = {{ statistics.monthly_counts|tojson }};
const labels = Object.keys(monthlyData);
const data = Object.values(monthlyData);

const ctx = document.getElementById('monthlyAppointmentsChart').getContext('2d');
new Chart(ctx, {
    type: 'bar',
    data: {
        labels: labels,
        datasets: [{
            label: 'Appointments',
            data: data,
            backgroundColor: 'rgba(59, 130, 246, 0.8)',
            borderRadius: 6
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display: false }
        },
        scales: {
            y: { beginAtZero: true }
        }
    }
});
</script>
{% endblock %}
